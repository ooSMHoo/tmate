<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="yearStats">
	<!-- 이번년도 예약 총건수 -->
	<select id="ycountRestotal" parameterType="map" resultType="Integer">
		SELECT COUNT(*)
		FROM reservation r
		JOIN reservationDetail r2 ON r.resNum = r2.resNum 
		JOIN room r3 ON r2.roomNum = r3.roomNum 
		WHERE r3.mhId =#{hostId}
   		AND  TO_CHAR(TRUNC(resReg_date,'YYYY'),'YYYYMMDD') = TO_CHAR(TRUNC(SYSDATE,'YYYY'),'YYYYMMDD')
	</select>
	
	<!-- 이번년도 총결제 금액 -->
	<select id="ytotalPay" parameterType="map" resultType="String">
		SELECT NVL(TO_CHAR(SUM(p.payCost), 'L99,999,999'),0)
		FROM memberHost m 
		JOIN member1 m1 ON m.mhId = m1.memberId
		JOIN room r3 ON m.mhId = r3.mhId
		JOIN reservationDetail r2 ON r3.roomNum = r2.roomNum
		JOIN reservation r ON r.resNum = r2.resNum 
		JOIN payment p ON r.resNum = p.resNum  
		WHERE m.mhId = #{hostId}
		 AND  TO_CHAR(TRUNC(resReg_date,'YYYY'),'YYYYMMDD') = TO_CHAR(TRUNC(SYSDATE,'YYYY'),'YYYYMMDD')
	</select>
	
	<!-- 이번년도 취소 총건 -->
	<select id="ycountCancel" parameterType="map" resultType="Integer">
		SELECT COUNT(*)
		FROM reservation r
		JOIN reservationDetail r2 ON r.resNum = r2.resNum 
		JOIN room r3 ON r2.roomNum = r3.roomNum 
		WHERE r3.mhId = #{hostId}
		AND  ((resCode = 1 OR resCode = 2) 
     		AND TO_CHAR(TRUNC(resReg_date,'YYYY'),'YYYYMMDD') = TO_CHAR(TRUNC(SYSDATE,'YYYY'),'YYYYMMDD'))
	</select>
	
	<!-- 이번연도 취소된 총 금액 -->
	<select id="ytotalpayCancel" parameterType="map" resultType="String">
		SELECT NVL(TO_CHAR(SUM(p.payCost), 'L99,999,999'),0)
		FROM memberHost m 
		JOIN member1 m1 ON m.mhId = m1.memberId
		JOIN room r3 ON m.mhId = r3.mhId
		JOIN reservationDetail r2 ON r3.roomNum = r2.roomNum
		JOIN reservation r ON r.resNum = r2.resNum 
		JOIN payment p ON r.resNum = p.resNum  
		WHERE m.mhId = #{hostId}
		AND ((resCode = 1 OR resCode = 2) 
    		AND TO_CHAR(TRUNC(resReg_date,'YYYY'),'YYYYMMDD') = TO_CHAR(TRUNC(SYSDATE,'YYYY'),'YYYYMMDD'))
	</select>

</mapper>