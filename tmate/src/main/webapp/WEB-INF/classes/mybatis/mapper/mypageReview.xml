<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="review">

	<select id="reviewMain" parameterType="map" resultType="com.sp.trip.review.Review">
		SELECT r.roomNum
		FROM member1 m
			JOIN reservation rv ON rv.memberId = m.memberId
			JOIN reservationDetail rd ON rv.resNum = rd.resNum
			JOIN room r ON rd.roomNum = r.roomNum
			JOIN lodging l ON l.mhId = r.mhId
		LEFT JOIN review review ON review.resNum = rv.resNum
		WHERE resCout_date &gt; SYSDATE AND resCode=0 AND m.memberId= #{memberId} AND revNum IS NULL
	</select>
	
	<select id="listReview" parameterType="map" resultType="com.sp.trip.review.Review">
		SELECT * FROM (
		      	 SELECT ROWNUM rnum, tb.* FROM (
		            SELECT r.roomNum, r.roomName, lodgName, TO_CHAR(resCout_date, 'MM.DD')resCout_date,revNum, rd.resNum 
		            FROM member1 m
					JOIN reservation rv ON rv.memberId = m.memberId
					JOIN reservationDetail rd ON rv.resNum = rd.resNum
					JOIN room r ON rd.roomNum = r.roomNum
					JOIN lodging l ON l.mhId = r.mhId
				LEFT JOIN review review ON review.resNum = rv.resNum
				WHERE resCout_date &gt; SYSDATE AND resCode=0 AND m.memberId= #{memberId}
				 <if test="revNum == 'true'">
				 	AND revNum IS NULL
				 </if>
				 <if test="revNum == 'false'">
					AND revNum IS NOT NULL
				</if>				 
	        ) tb WHERE ROWNUM &lt;= #{end}
	    ) WHERE rnum &gt;= #{start}
	</select>	
	
	<select id="dataCount" parameterType="map" resultType="Integer">
		SELECT NVL(COUNT(*), 0)
		FROM member1 m
			JOIN reservation rv ON rv.memberId = m.memberId
			JOIN reservationDetail rd ON rv.resNum = rd.resNum
			JOIN room r ON rd.roomNum = r.roomNum
			JOIN lodging l ON l.mhId = r.mhId
		LEFT JOIN review review ON review.resNum = rv.resNum
		WHERE resCout_date &gt; SYSDATE AND resCode=0 AND m.memberId= #{memberId}
        <if test="revNum == 'true'">
			AND revNum IS NULL
		</if>
		 <if test="revNum == 'false'">
			AND revNum IS NOT NULL
		</if>
	</select>
</mapper>